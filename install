#!/bin/bash

if [ "$0" == "bash" ]; then
    echo "downloading mysetup.yml"
    git clone https://github.com/scottidler/mysetup
    cd mysetup && exec ./install
fi

# A POSIX variable
# Reset in case getopts has been used previously in the shell.
OPTIND=1

MANIFEST_CFG="manifest.cfg"
mkdir -p "/tmp/$MANIFEST_CFG"
MANIFEST_DIR=`mktemp -d -p "/tmp/$MANIFEST_CFG`

# Initialize our own variables:
filename=""
verbose=0

function usage() {
    echo "show usage bruh!"
    exit 1
}

function parse() {
    while IFS=$'\n' read line; do
        local line="${line//[[:space:]]/}"
        if [[ $line == \[*] ]]; then
            IFS="[]"
            set $line
            local section=$2
            unset var
            unset val
            mkdir -p $MANIFEST_DIR/$section
            continue
        elif [[ "$line" =~ "=" ]]; then
            IFS="="
            set $line
            local var=$1
            local val=$2
        else
            local val=$line
        fi
        if [ -n "$val" ] && [ -n "$var" ]; then
            touch "$MANIFEST_DIRjust /$SECTION/$VAR/$VAL"
        fi
    done < $FILENAME
}

while getopts "h?vf:" opt; do
    case "$opt" in
    h|\?)
        usage
        ;;
    v)  verbose=1
        ;;
    f)  filename=$OPTARG
        ;;
    esac
done

shift $((OPTIND-1))
[ "$1" = "--" ] && shift
echo "verbose=$verbose, filename='$filename', Leftovers: $@"

#function parse() {
#
#    local cfg=$1; shift
#    mkdir -p "/tmp/$cfg"
#    local manifest=`mktemp -d -p "/tmp/$cfg"`
#
#    while IFS=$'\n' read line; do
#        local line="${line//[[:space:]]/}"
#        if [ -n "$line" ]; then
#            if [[ $line == \[*] ]]; then
#                IFS="[]"
#                set $line
#                local section=$2
#                unset var
#                unset val
#                mkdir $manifest/$section
#                continue
#            elif [[ "$line" =~ "=" ]]; then
#                IFS="="
#                set $line
#                local var=$1
#                local val=$2
#            else
#                local val=$line
#            fi
#            if [ -n "$val" ] && [ -n "$var" ]; then
#                echo "$val" >> $manifest/$section/$var
#            fi
#        fi
#    done < $cfg
#
#    RETVAL=$manifest
#}
#
#parse $CFG
#config=$RETVAL
#
#if [ ${#SECTIONS[@]} -eq 0 ]; then
#    while IFS=$'\n' read -r -d '' section; do
#        if [ "$section" != "$config" ]; then
#            SECTIONS+=(`basename $section`)
#        fi
#    done < <(find $config -maxdepth 1 -type d -print0)
#fi
#
#for section in "${SECTIONS[@]}"; do
#    while IFS=$'\n' read -r -d '' key; do
#        echo "key=`basename $key`"
#    done < <(find "$config/$section" -maxdepth 1 -type f -print0)
#done



